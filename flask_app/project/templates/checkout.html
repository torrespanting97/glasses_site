{% extends "base.html" %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Checkout</h2>

    <div id="checkout-messages" class="alert" style="display: none;"></div>

    <div class="row">
        <div class="col-md-8 order-md-1">
            <h4 class="mb-3">Payment Information</h4>
            <form id="payment-form">
                <!-- Stripe Card Element will be inserted here -->
                <div class="form-group">
                    <label for="card-element">Credit or debit card</label>
                    <div id="card-element" class="form-control" style="padding: .75rem .75rem;">
                        <!-- A Stripe Element will be inserted here. -->
                    </div>
                </div>

                <!-- Used to display form errors. -->
                <div id="payment-errors" role="alert" class="text-danger mt-2 mb-2"></div>

                <button id="submit-payment-button" class="btn btn-primary btn-lg btn-block mt-4">Pay Now</button>
            </form>
        </div>

        <div class="col-md-4 order-md-2 mb-4">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">Your cart</span>
                <!-- Cart item count can be dynamically updated here if needed -->
                <span class="badge badge-secondary badge-pill" id="checkout-cart-item-count">0</span>
            </h4>
            <ul class="list-group mb-3" id="checkout-cart-summary">
                <!-- Cart items summary can be dynamically populated here by JS -->
                <!-- Example:
                <li class="list-group-item d-flex justify-content-between lh-condensed">
                    <div>
                        <h6 class="my-0">Product name</h6>
                        <small class="text-muted">Brief description</small>
                    </div>
                    <span class="text-muted">$12</span>
                </li>
                -->
                <li class="list-group-item d-flex justify-content-between">
                    <span>Total (USD)</span>
                    <strong id="checkout-cart-total-amount">$0.00</strong>
                </li>
            </ul>
            <!-- Input for amount for testing purposes if cart total isn't dynamically fetched -->
            <div class="form-group">
                <label for="amount-to-charge">Amount to Charge (cents):</label>
                <input type="number" id="amount-to-charge" class="form-control" value="2000">
                <small class="form-text text-muted">For testing: e.g., 2000 for $20.00</small>
            </div>
        </div>
    </div>
</div>

<!-- Make Stripe Public Key available to JavaScript -->
<script>
    var stripePublicKey = "{{ stripe_public_key }}";
</script>
<!-- Include Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>
<!-- Include your custom checkout JavaScript -->
<script src="{{ url_for('static', filename='js/checkout.js') }}"></script>
{% endblock %}
